% datum?
\documentclass[thesis=B,czech]{FITthesis}[2019/03/06]

\usepackage[utf8]{inputenc} % LaTeX source encoded as UTF-8

% my packages and stuff
\usepackage{todonotes}
\usepackage{xevlna}
% from https://tex.stackexchange.com/a/251025
\usepackage{relsize}
\usepackage{xspace}
\newcommand{\Rplus}{\protect\hspace{-.1em}\protect\raisebox{.35ex}{\smaller{\smaller\textbf{+}}}}
\newcommand{\Cpp}{\mbox{C\Rplus\Rplus}\xspace}

\hyphenation{NETCONF}


\department{Katedra softwarového inženýrství}
\title{Nástroj pro konfiguraci a monitorování}
\authorGN{Václav}
\authorFN{Kubernát}
\authorWithDegrees{Václav Kubernát}
\author{Václav Kubernát}
\supervisor{Ing. Tomáš Čejka, Ph.D.}
% TODO: dopsat
\acknowledgements{Doplňte, máte-li komu a za co děkovat. V~opačném případě úplně odstraňte tento příkaz.}
% TODO: dopsat
\abstractCS{V~několika větách shrňte obsah a přínos této práce v~češtině. Po přečtení abstraktu by se čtenář měl mít čtenář dost informací pro rozhodnutí, zda chce Vaši práci číst.}
% TODO: dopsat
\abstractEN{Sem doplňte ekvivalent abstraktu Vaší práce v~angličtině.}
\placeForDeclarationOfAuthenticity{V~Praze}
% TODO: zkontrolovat
\declarationOfAuthenticityOption{4} %volba Prohlášení (číslo 1-6)
% TODO: dopsat
\keywordsCS{Nahraďte seznamem klíčových slov v češtině oddělených čárkou.}
% TODO: dopsat
\keywordsEN{Nahraďte seznamem klíčových slov v angličtině oddělených čárkou.}
% TODO: mám sem hodit link na git?
% \website{http://site.example/thesis} %volitelná URL práce, objeví se v tiráži - úplně odstraňte, nemáte-li URL práce

\begin{document}

\begin{introduction}
% TODO: krátce napsat, k čemu ten program je

% TODO: zmínit NETCONF

% TODO: napsat, komu se to hodí (cesnet síťaři) a (krátce) co měli doteď

% TODO: ... a možná že se to bude používat na nějakých zařízeních (zjistit od Honzy, jak to přesně je)
\end{introduction}


\chapter{Cíl práce} \todo{Jsou cíle nutné? V podstatě tu jen opisuju zadání\ldots Ideálně bych to mergenul do úvodu nebo tak}
Cílem práce je vytvořit konzolovou aplikaci, pomocí které lze vzdáleně konfigurovat zařízení pomocí protokolu NETCONF\@. Aplikace bude intuitivní, uživatel by ji měl být schopný ovládat i bez detailní znalosti NETCONF\@. Příkazy a jejich argumenty bude možné stiskem klávesy automaticky doplňovat.


\chapter{Existující relevantní práce}
% TODO: Popsat detailněji, co je třeba, aby ten program dělal/uměl (nějaký use-case nebo tak něco) a že to současné programy neumí
\section{Netopeer2-cli}
% TODO: Dopsat
\section{sysrepocfg}
% TODO: Konkrétně popsat výhody, nevýhody (například, že to nemá nic společného s netconfem xd)
\section{TODO Mrknout na další programy (ne nutně cesneťácké)}


\chapter{Návrh}
% TODO: něco sem možná
\section{NETCONF a YANG}
\textit{NETCONF} je protokol sloužící ke vzdálené úpravě konfigurace síťových zařízení. Je založen na XML-RPC\todo{vysvětlivku}. \textit{YANG}\todo{ref na RFC} je jazyk sloužící k modelování konfigurace. Pomocí různých zabudovaných konstruktů lze vybudovat konfigurační strom, který logicky sdružuje různé druhy konfigurace, definuje kde lze jakou hodnotu nastavit, jaké mají datové typy apod. Kromě konfigurace podporuje \textit{YANG} i definování různých procedur, které lze volat pomocí protokolu \textit{NETCONF}.
% TODO: nějaký příklad YANGu

Více o \textit{YANGu} v kapitole\todo{nějaký ref nebo něco}.


\section{Syntaxe}
Základní syntaxe programu vypadá takto:
% TODO: přidat nějakou syntaxi, něco jako "/> <název příkazu> <přepínače> <argumenty>"

K pohybování konfiguračním stromem jsem zvolil podobný princip jako při pohybu adresářovou strukturou v počítači. Uživatel prozkoumává strom známými příkazy jako například \textit{cd}, nebo \textit{ls}. K manipulaci s hodnotami slouží například příkazy \textit{get} a \textit{set}.

\begin{description} % TODO: příkazy jen takhle v seznamu nebo pro každej udělat subsection a popsat?
    \item[TODO]{příkazy}
\end{description}

Program je koncipován jako interaktivní konzolová aplikace. Silnou stránkou konzolových aplikací je možnost použití ve skriptech\todo{vysvětlivka?}. Uživatel může aplikaci použít jednak interaktivně, napojením terminálu na vstup programu a manuálním zadáváním příkazů, ale také dávkově, uložením příkazů do souboru a vložením tohotu souboru na vstup programu.
% TODO: přidat příklad použití (nějakej copy paste z shellu)

Aby bylo možné zadávat příkazy intuitivně, nabízí aplikace uživateli různé prostředky pro ulehčení zadávání vstupu, například různé klávesové zkratky pro pohyb v zadávaném textu, automatické doplňování stiskem tabulátoru (nebo jiné klávesové zkratky) a ukládání historie zadaných příkazů.


\chapter{Implementace}
% TODO: dopsat něco o použitém jazyku a proč zrovna \Cpp{}

\section{Součásti programu}
% TODO: obrázek kudy jdou data; pracovní cyklus programu (nějaký vývoják input -> parser -> interpreter...)

\subsection{Uživatelské rozhraní}
Uživatelské rozhraní je poměrně přímočaré: program cyklicky načítá řádky uživatelského vstupu a zpracovává je. K interaktivnímu používání aplikace, je nutné implementovat nějaký způsob editace příkazové řádky. To zahrnuje především:
\begin{itemize}
\item možnost úpravy aktuálního obsahu příkazové řádky před odesláním
\item klávesové zkratkty \todo{Reword this}
\item automatické doplňování příkazů pomocí klávesové zkratky
\item ukládání historie příkazů
\end{itemize}
Ideální knihovna by měla mít nativní \Cpp{} rozhraní (ačkoliv lze v \Cpp{} relativně jednoduše použít i C knihovny) a být header-only, tedy, že k jejímu použití stačí přidat její hlavičkový soubor a všechny implementační detaily jsou obsaženy v něm.

Nejznámější knihovna využívaná k tomuto účelu je \textit{GNU Readline}\todo{ref?}. \textit{Readline} umožňuje editaci příkazové řádky pomocí mnoha klávesových zkratek, převzatých z textových editorů \textit{EMACS} a \textit{Vi} a také velmi intuitivní inkrementální automatické doplňování (tj.\ postupně doplňování vícenásobným stisknutím klávesové zkratky). Nicméně, vzhledem k tomu, že je již poměrně zastaralá, má pouze rozhraní v jazyce C, tudíž to není dobrá volba pro moji aplikaci. Další nevýhodou je její implementace: \textit{Readline} obsahuje přibližně 20 tisíc řádek kódu především kvůli kompatibilitě s mnoha emulátory terminálů. V dnešní době většina terminálových aplikací podporuje základní VT100 escape sekvence\todo{vysvětlivku} a tudíž není třeba zastaralé terminály podporovat.\todo{ref na linenoise readme.md}

Méně těžkotonážní variantou je knihovna \textit{linenoise}. Ta je oproti \textit{Readline} velmi malá --- má\todo{reword?} zhruba tisíc řádků. Její odnož \textit{cpp-linenoise} napsaná přímo v \Cpp{}, tudíž odpadají různé nevýhody použití jazyka C, a je header-only. Z hlediska funkčních požadavků \textit{cpp-linenoise} bohužel zaostává: nepodporuje mnoho klávesových zkratek (například kombinace klávesy Ctrl a směrových šipek) a automatické doplňování je pouze velmi jednoduché (neinkrementální).  Všechny tyto nedostatky řeší knihovna \textit{replxx}. Ta oproti \textit{linenoise} není header-only, nicméně velmi dobře napodobuje \textit{Readline} z hlediska podpory klávesových zkratek a automatického dokončování. Ve svém programu jsem tedy zvolil knihovnu \textit{replxx}.

% TODO: ukázat docopt.cpp (Ale někde jinde)

\subsection{Zpracování vstupu}
% TODO: intro o vstupu
% TODO: ukázat gramatiky

Ke zpracování gramatik příkazů je potřeba parser\todo{vysvětlivka}. Implementaci parseru lze provést manuálně, to ovšem může být u složitých gramatik velmi nepraktické, a proto je vhodné použít nějakou knihovnu, která dokáže parser vygenerovat. Na základě doporučení \todo{V podstatě jsem ji použil jen tak, bez zvážení, na základě Honzy} jsem použil knihovnu \textit{Boost Spirit X3}. Jednou z hlavních výhod knihovny \textit{Spirit} je, že gramatiky lze zádavat přímo do zdrojového kódu výhradně pomocí prostředků jazyka --- operátorů. To znamená, že není potřeba spouštět žádný preprocesor\todo{vysvětlivka}, který by převedl speciální syntaxi parseru do validního \Cpp{} kódu.
\todo[inline]{Ukázka gramatiky napsané pomocí Spiritu}
% TODO: dopsat gramatiky na základě datového modelu


% TODO: ukázat Boost Spirit
% TODO: ukázat libyang

\subsection{Interpreter}
% TODO: dopsat (vezme user input a zavolá metody/funkce...)

\subsection{DatastoreAccess}
% TODO: dopsat (abstraktní rozhraní pro přístup do datastoru...)

\subsubsection{NetconfAccess}
% TODO: ukázat libnetconf2

\subsubsection{SysrepoAccess}
% TODO: ukázat sysrepo klientskou knihovnu

\subsection{Testování}
% TODO: ukázat doctest
% TODO: ukázat trompeloeil
% TODO: zmínit Catch

\subsection{Knihovna na logování?}
% TODO: spdlog, použito jen v netconf cpp wrapperu... od Honzy


\chapter{Vyhodnocení}
\section{Testování}
% TODO: testování přes doctest, především unit testy, ale i nějaký jiný (sysrepo.cpp)\@. hlášení bugů přes issue tracker, po opravení napsán test
\section{Porovnání s konkurencí}
% TODO: popsat, že ačkoliv moje aplikace nepodporuje 100 \% YANGu/NETCONFu, na základní použití stačí (hlavní cíl byl, upravovat konfiguraci bez znalosti YANG modelů a NETCONFu)
\section{Výsledky z nasazení}
% TODO: no, prej to Honza používá xD

\begin{conclusion}
% TODO: Něco dopsat sem, asi v závislosti na zbytku
\end{conclusion}

\bibliographystyle{csn690}
\bibliography{mybibliographyfile}

\appendix

\chapter{Seznam použitých zkratek}
% \printglossaries
\begin{description}
	\item[GUI] Graphical user interface
	\item[XML] Extensible markup language
\end{description}

\chapter{Obsah přiloženého CD}

%\begin{figure}
%	\dirtree{
%            .1
%	}
%\end{figure}

\end{document}
